



</div>
</div>



<script>
var queued = {};
<% if(locals.queued) { %>
queued = <%- JSON.stringify(queued) %>;
<% } %>
</script>


<script>
var DUs = {};
Array.prototype.forEach.call(document.querySelectorAll('[data-DU]'), function(el) {
  var SLUM = el.getAttribute('data-SLUM');
  DUs[SLUM] = {
    dom: el,
    val: el.getAttribute('data-DU')
  };
});

if(Object.keys(DUs).length) {
  var DUInterval = setInterval(function(){
    for(var DU in DUs){
      if(!queued[DU]) {
        DUs[DU].dom.innerText = ++DUs[DU].val;
      }
    }
    if(Object.keys(DUs).length === 0) {
      clearInterval(DUInterval);
    }
  }, 1000);
}

var ENDs = [];
Array.prototype.forEach.call(document.querySelectorAll('[data-END]'), function(el) {
  ENDs.push({
    dom: el,
    val: el.getAttribute('data-END')
  });
});

var now = parseInt(+new Date() / 1000, 10);

if(ENDs.length) {
  var EndInterval = setInterval(function(){
    ENDs.forEach(function(END){
      END.dom.innerText = moment.duration((END.val - now), 'seconds').humanize(true)
    })
  }, 60000);
}

var openCount = document.getElementById('open-count')
var open = io('http://localhost:3000/open');
open.on('run', function(msg){
  console.log(msg);
  if(msg.type === 'END') {
    openCount.innerText = msg.open;
    if (DUs[msg.SLUM].dom.classList) {
      DUs[msg.SLUM].dom.classList.add('run-done');
    } else {
      // IE9 compat
      DUs[msg.SLUM].dom.className += ' ' + 'run-done';
    }
    delete DUs[msg.SLUM];
    return;
  }
  if(msg.type === 'STA') {
    openCount.innerText = msg.open;
    delete queued[msg.SLUM];
    return;
  }
});

</script>

</body>
</html>
